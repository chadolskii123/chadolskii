{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Base Template</title>
    {% include 'base/css.html' %}
    {% block base_head %}{% endblock %}
</head>
<body>
{% include "base/navbar.html" with brand_name="eCommerce" %}
<!--    include문 안에 with를 쓸 때는 띄어쓰기 없이 써야 한다,,,,,, 하,,,, -->
<div class="container">
    {% block content %}

    {% endblock %}
</div>
{% include 'base/js.html' %}
<script>
    $(document).ready(function () {
        let productForm = $(".form-product-ajax")

        productForm.submit(function (event) {
            event.preventDefault();
            console.log("form is not sending");
            let thisForm = $(this);
            let actionEndpoint = thisForm.attr('action');
            let httpMethod = thisForm.attr('method');
            let formData = thisForm.serialize();

            $.ajax({
                url: actionEndpoint,
                method: httpMethod,
                data: formData,
                success: function (data) {
                    console.log("success");
                    console.log(data);
                    let submitSpan = thisForm.find(".submit-span");
                    if (data.added) {
                        submitSpan.html('<button type="submit" class="btn btn-primary"> Remove?</button>')
                    } else {
                        submitSpan.html(' <button type="submit" class="btn btn-success">Add to Cart</button>')
                    }
                    let navbarCount = $(".navbar-cart-count")
                    navbarCount.text(data['cartItemCount']);
                },
                error: function (errorData) {
                    console.log("error");
                    console.log(errorData);
                }
            })


        });
    });
</script>
</body>
</html>